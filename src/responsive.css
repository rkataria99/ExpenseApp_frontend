/* =========================================================
   Responsive Overrides for Expense Tracker
   (pairs with styles.css; Navbar is fixed)
   ========================================================= */

/* ---------- Fixed navbar: on top, clickable ---------- */
.navbar {
  position: fixed !important;
  top: 0; left: 0; right: 0;
  z-index: 10000;                /* above content */
}
.navbar, .navbar * { pointer-events: auto !important; }
.navbar .nav-inner { overflow: visible !important; }

/* The spacer element right after Navbar handles the offset — no page padding hacks */

/* ---------- Base container scaling (desktop → 4K) ---------- */
.container {
  max-width: min(1200px, 92vw) !important;
  margin-left: auto;
  margin-right: auto;
}
@media (min-width: 1600px) {
  .container { max-width: min(1400px, 88vw) !important; }
}
@media (min-width: 1920px) {
  .container { max-width: min(1680px, 92vw) !important; }
}
@media (min-width: 2560px) {
  .container, .navbar .nav-inner { max-width: 92vw !important; }
}
@media (min-width: 3840px) {
  .container, .navbar .nav-inner { max-width: 94vw !important; }
}

.card { width: 100%; max-width: 100%; }
section, .section, .card, .panel, .box { margin-bottom: 12px; }
html, body, #root { overflow-x: hidden; }

/* =========================================================
   Layout stacking rules
   ========================================================= */

/* Keep grids intact at 1024 (so KPI row stays one line). Collapse below. */
@media (max-width: 1023px) {
  .grid { display: block !important; }
  .grid > * { margin-bottom: 12px; width: 100% !important; }
}

/* Stack .row only below 900px (so 1024 stays side-by-side) */
@media (max-width: 900px) {
  .row {
    display: flex !important;
    flex-direction: column !important;
    flex-wrap: nowrap !important;
    gap: 12px;
  }
  .row > * { width: 100% !important; }
}

/* Phones: one-column everywhere */
@media (max-width: 700px) {
  .grid, .row { display: block !important; }
  .grid > *, .row > * { width: 100% !important; margin-bottom: 12px; }
}

/* Optional desktop main+aside grid */
@media (min-width: 901px) {
  .home-grid, .dashboard-grid, .two-col {
    display: grid !important;
    grid-template-columns: 1.25fr 0.85fr;
    gap: 16px;
    align-items: start;
  }
}

/* =========================================================
   KPI / Stat cards
   ========================================================= */
.kpi, .stat, .metric { min-width: 0; }
.kpi *, .stat *, .metric * { overflow-wrap: break-word; word-break: normal; }

@media (max-width: 480px) {
  .btn.warn, .clear, .btn-clear, .clear-btn {
    position: static !important;
    transform: none !important;
    margin-left: auto;
    display: inline-block;
  }
  .kpi .val { font-size: 18px; }
}

/* Keep the KPI "Clear" pill on one line on laptop+ */
.kpi .btn,
.kpi .btn.warn,
.kpi .clear {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
  min-width: 72px;
  flex: 0 0 auto;
  text-align: center;
  padding-left: 12px;
  padding-right: 12px;
  line-height: 1;
}

/* =========================================================
   Tables (phone-friendly)
   ========================================================= */
.table-responsive,
.card:has(table),
.table-wrap,
.table-wrapper {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
@media (max-width: 700px) {
  .table, table { min-width: 640px; }
  .table th, .table td, table th, table td {
    padding: 8px;
    font-size: 13px;
    white-space: nowrap;
  }
}

/* =========================================================
   Forms / Typography
   ========================================================= */
@media (max-width: 480px) {
  .container { max-width: 100% !important; }
  input, select, textarea, .btn, button { max-width: 100%; }
  input, select, textarea { padding: 9px; font-size: 14px; }
  .btn, button { padding: 9px 12px; font-size: 14px; }
  label { font-size: 13px; }
}
@media (max-width: 360px) {
  h1 { font-size: 18px; }
  h2 { font-size: 16px; }
  .small, small { font-size: 12px; }
}
img, svg, canvas, video { max-width: 100%; height: auto; display: block; }
.chart, .chart-wrap, .canvas-wrap { overflow-x: auto; }

/* =========================================================
   Navbar crowding fixes (425/375/320)
   ========================================================= */
@media (max-width: 1024px) {
  .navbar .nav-inner { gap: 8px; }
  .nav-btn { padding: 7px 10px; }
}

/* ≤425px: brand left, actions can scroll horizontally */
@media (max-width: 425px) {
  .navbar { padding-left: 8px; padding-right: 8px; }
  .navbar .nav-inner {
    display: flex !important;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }
  .brand { flex: 1 1 auto; min-width: 0; }
  .brand * { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

  .nav-actions {
    margin-left: auto !important;
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 0 0 auto;
    white-space: nowrap;
    flex-wrap: nowrap;
    overflow-x: auto;                   /* way better than wrapping at this width */
    -webkit-overflow-scrolling: touch;
    max-width: 68vw;
  }
  .nav-actions::-webkit-scrollbar { display: none; }
  .nav-btn, .navbar .btn { padding: 6px 8px; line-height: 1; }
}

/* ≤340px: stack actions under the brand (clean taps) */
@media (max-width: 340px) {
  .navbar .nav-inner {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 6px !important;
  }
  .brand { order: 1; width: 100%; min-width: 0; }

  .nav-actions {
    order: 2;
    width: 100%;
    max-width: none;
    overflow: visible !important;
    display: flex;
    flex-wrap: wrap;
    row-gap: 6px;
    column-gap: 0;
    justify-content: stretch;
  }

  .nav-actions .nav-btn,
  .navbar .btn {
    flex: 1 1 100%;                     /* one per row; change to 50% for 2-col */
    padding: 8px 10px;
    position: relative;
    z-index: 2;
  }

  .nav-actions span { display: inline !important; }
}

/* =========================================================
   FINAL tiny-screen patches (≤360)
   ========================================================= */
@media (max-width: 360px) {
  .container { max-width: 100vw !important; padding-left: 8px; padding-right: 8px; }

  form.card, .card, form {
    min-width: 0 !important;
    width: 100% !important;
    overflow: hidden;
  }
  .card > *, .card .row > *, .card .grid > * { max-width: 100% !important; }

  /* Full-width buttons ONLY inside forms */
  form .btn, form button, .card form .btn, .card form button {
    width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }
  /* Not navbar/KPI */
  .navbar .btn, .nav-actions .nav-btn, .kpi .btn, .kpi .clear {
    width: auto !important;
    min-width: auto !important;
  }

  input[type="date"] { width: 100% !important; min-width: 0 !important; }
  .card .row { display: block !important; gap: 10px !important; }

  .kpi .label, .kpi .tag, .kpi small, .kpi h4, .kpi h5 {
    font-size: 12px !important;
    line-height: 1.25 !important;
  }
}

/* Utilities */
.max-w-screen { max-width: 100vw; }
.w-full { width: 100%; }
.scroll-x { overflow-x: auto; -webkit-overflow-scrolling: touch; }
.hide-on-mobile { display: none; }
@media (min-width: 901px) { .hide-on-mobile { display: initial; } }

/* Anchors used for scrolling: don't steal a grid column */
.scroll-target {
  position: relative;
  top: calc(var(--nav-h, 60px) * -1); /* sits just under the fixed navbar */
  height: 0;
  margin: 0;
  padding: 0;
  border: 0;
  display: block;
}

/* If an anchor is inside a grid, make it span the whole row */
.grid .scroll-target {
  grid-column: 1 / -1; /* full width row, zero height */
}

/* Safety: ensure grids really are grids above tablet */
@media (min-width: 1024px) {
  .grid { display: grid !important; }
}

/* =========================================================
   Navbar: Quick actions dropdown & responsive visibility
   ========================================================= */

/* Show dropdown at ≤1024 (tablet & smaller) */
.qa-dropdown { display: none; position: relative; }
@media (max-width: 1024px) {
  .qa-dropdown { display: inline-block; }
}

/* Inline buttons that should disappear on tablet & down */
@media (max-width: 1024px) { .hide-at-tablet { display: none !important; } }
/* Inline "All Transactions" disappears at ≤425 */
@media (max-width: 425px) { .hide-at-425 { display: none !important; } }
/* Inline "Reports" disappears strictly below 425 */
@media (max-width: 424px) { .hide-below-425 { display: none !important; } }

/* Dropdown menu styles */
.qa-toggle { position: relative; z-index: 2; }
.qa-menu {
  position: absolute;
  right: 0;
  top: calc(100% + 6px);
  min-width: 190px;
  background: var(--panel, #fff);
  border: 1px solid var(--border, rgba(0,0,0,.08));
  box-shadow: 0 8px 24px rgba(0,0,0,.12);
  border-radius: 10px;
  padding: 8px;
  z-index: 10001;
}
.qa-item {
  display: block;
  width: 100%;
  text-align: left;
  padding: 8px 10px;
  border-radius: 8px;
  font: inherit;
  background: transparent;
  border: 0;
  cursor: pointer;
  color: inherit;
  text-decoration: none;           /* remove blue underline for <Link> */
  white-space: nowrap;
}
.qa-item:hover,
.qa-item:focus { background: rgba(0,0,0,.05); outline: none; }

/* Default: hide these (prevent dupes) */
.dd-transactions, .dd-reports { display: none; }

/* Which items appear in the dropdown at each size */
@media (min-width: 426px) and (max-width: 1024px) {
  .qa-dropdown .dd-transactions,
  .qa-dropdown .dd-reports { display: none !important; }
}
@media (max-width: 425px) {
  /* We hid inline "All Transactions" at this width, so show it in the menu */
  .qa-dropdown .dd-transactions { display: block !important; }
  .qa-dropdown .dd-reports { display: none !important; } /* keep Reports inline at 425 */
}

/* Below 425, also move Reports into the dropdown */
@media (max-width: 424px) {
  .qa-dropdown .dd-reports { display: block !important; }
}

/* --- Fix: prevent clipping at 375px (menu inside scrollable bar) --- */
@media (max-width: 425px) {
  .nav-actions { overflow: visible !important; max-width: 68vw; } /* allow dropdown to escape */
}

/* --- Fix: at very small widths, show menu as a fixed overlay so it never overflows --- */
@media (max-width: 375px) {
  .qa-dropdown { position: static; }
  .qa-menu {
    position: fixed;
    left: 8px;
    right: 8px;
    top: calc(var(--nav-h, 60px) + 6px);
    min-width: 0;
    width: auto;
    max-height: calc(100vh - var(--nav-h, 60px) - 20px);
    overflow: auto;
  }
}
